#!/usr/bin/env bash

if [[ $# -ne 1 ]]; then
  cat <<-EOF
Usage: $0 DRAFT_TITLE

Example:
  $0 "Developing Clojure in Vim"
EOF
fi

draft_title="$1"

scriptdir=$(dirname $0)
drafts_dir="$(dirname $0)/../src/_drafts"

draft_template=$(cat <<-EOF
---
layout: post
title: "DRAFT_TITLE"
category: something
tags:
  - foo
  - bar
  - baz
published: true
---

{% include JB/setup %}

Text goes here!

# Comments?

Reply to [this tweet][tweet] with any comments, questions, etc.!

[tweet]: https://twitter.com/dave_yarwood/status/FIXME
EOF
)

draft_content=$(sed \
                 "s/DRAFT_TITLE/$draft_title/g" \
                 <(echo -e "$draft_template"))

draft_filename="$(echo "$draft_title" \
                    | tr ' ' '-' \
                    | tr [:upper:] [:lower:] \
                    | tr -dc '[:alnum:]-').md"

echo -e "$draft_content" > "$drafts_dir/$draft_filename"

$EDITOR "$drafts_dir/$draft_filename"
